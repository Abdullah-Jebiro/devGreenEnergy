import{a as it}from"./chunk-QC33BZS7.js";import{d as te,e as ee}from"./chunk-AXPFAJA2.js";import{a as z,b as we}from"./chunk-GGXNRK7F.js";import{a as Te}from"./chunk-3Z2KSGKD.js";import{$a as St,$b as ve,Ba as Yt,Db as ae,Ea as L,Fb as re,Fc as G,Gc as Ee,Ha as et,Hb as le,Ib as se,Ja as S,La as nt,Ma as ut,N as Jt,Qb as ce,Ra as pt,Rb as de,Sa as _t,Sb as me,Ta as ft,Tb as ue,Ub as pe,Va as gt,Vb as _e,W as Kt,Wa as Ct,Wb as fe,Xa as ht,Xb as ge,Ya as vt,Yb as Ce,Za as xt,Zb as he,b as zt,bb as bt,cb as $,cc as xe,eb as Zt,fa as B,gc as Mt,ha as tt,hc as Se,ic as be,jc as Me,ka as Xt,kc as yt,m as mt,nc as ye,o as Z,ob as ne,oc as Ae,pc as Ie,qc as Re,rb as Dt,sb as ie,tb as oe,xa as j}from"./chunk-XKYZBQRO.js";import{$b as v,Ac as Lt,Bc as $t,Bd as Qt,Ea as C,Ec as W,Fa as h,Fb as f,Hb as d,Mc as Gt,Ob as Bt,Sb as c,Tb as s,Ub as I,Vb as V,Wb as D,Xb as E,Yb as R,a as K,bc as u,bd as wt,dd as X,ed as q,fc as M,fd as Y,hc as Rt,hd as dt,ib as l,ic as Tt,ja as ct,jb as b,jc as Et,mc as w,nc as m,oa as It,oc as x,pc as T,qc as at,rc as rt,sc as lt,ta as N,tc as jt,uc as U,ud as Ht,vd as Wt,wc as y,xc as k,yd as kt,zd as Vt}from"./chunk-WSHGJWKC.js";var O=function(e){return e.All="all",e.WithoutStationsAccess="without-stations-access",e.WithoutTransformers="without-transformers",e.OnlyTransformers="only-transformers",e}(O||{});var H=(()=>{let r=class r{constructor(t,i){this.http=t,this.customServices=i,this.stationURL=`${Dt.apiUrl}/Stations`,this.URL=`${Dt.apiUrl}/StationMonitors`}getStationMonitors(t,i){return this.customServices.getRequests(`${this.URL}?StationId=${t}&Date=${i}`)}getStation(t){return this.customServices.getRequests(`${this.stationURL}?Category=${t}`)}deleteMonitor(t){return this.customServices.deleteRequest("")}getFormData(t,i){let n=`${this.URL}/data/${t}`;return i&&(n+="?IsUpdate=true"),this.customServices.getRequests(n)}addStationMonitor(t){return this.customServices.postRequest(this.URL,t)}getStationMonitorById(t){return this.customServices.getRequests(`${this.URL}/byId?id=${t}`)}putStationMonitor(t){return this.customServices.putRequest(`${this.URL}/update`,t)}deleteStationMonitor(t){return this.http.delete(`${this.URL}/delete`,{body:{monitorId:t}})}};r.\u0275fac=function(i){return new(i||r)(It(zt),It(Ee))},r.\u0275prov=ct({token:r,factory:r.\u0275fac,providedIn:"root"});let e=r;return e})();function Le(e,r){if(e&1&&(c(0,"mat-option",6),m(1),s()),e&2){let o=r.$implicit;d("value",o),l(),T(" ",o.title," ")}}var Ve=(()=>{let r=class r{onStationChange(t){this.id=t.value.id,console.log(this.id)}constructor(t,i,n,a,p,_){this.dialogRef=t,this.data=i,this.stationMonitorService=n,this.snackBarService=a,this.dialog=p,this.router=_,this.id=0,this.stations=[]}confirmChooseStation(){this.router.navigate(["/station-monitor/create",this.id]),this.dialogRef.close(!1)}ngOnInit(){this.stations=this.data.stations,console.log(this.stations)}onCancel(){this.dialogRef.close(!1)}};r.\u0275fac=function(i){return new(i||r)(b(be),b(Me),b(H),b(z),b(yt),b(Z))},r.\u0275cmp=N({type:r,selectors:[["app-choose-station"]],standalone:!0,features:[U],decls:11,vars:2,consts:[[1,"station-drop-down","style-header"],["appearance","fill",1,"add-station-select"],[3,"selectionChange"],[3,"value",4,"ngFor","ngForOf"],["mat-button","",3,"click"],["mat-button","","cdkFocusInitial","",3,"click","disabled"],[3,"value"]],template:function(i,n){i&1&&(c(0,"div",0)(1,"mat-form-field",1)(2,"mat-label"),m(3,"\u0627\u062E\u062A\u0631 \u0645\u062D\u0637\u0629"),s(),c(4,"mat-select",2),v("selectionChange",function(p){return n.onStationChange(p)}),f(5,Le,2,2,"mat-option",3),s()()(),c(6,"mat-dialog-actions")(7,"button",4),v("click",function(){return n.onCancel()}),m(8,"\u0625\u0644\u063A\u0627\u0621"),s(),c(9,"button",5),v("click",function(){return n.confirmChooseStation()}),m(10,"\u0645\u0648\u0627\u0641\u0642"),s()()),i&2&&(l(5),d("ngForOf",n.stations),l(4),d("disabled",n.id===0))},dependencies:[G,q,L,j,tt,ye,$,B],styles:[".station-drop-down[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;padding:16px}.station-drop-down[_ngcontent-%COMP%]   .add-station-select[_ngcontent-%COMP%]{width:100%;max-width:300px}.station-drop-down[_ngcontent-%COMP%]   .add-station-select[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{width:100%}.station-drop-down[_ngcontent-%COMP%]   .add-station-select[_ngcontent-%COMP%]   mat-select[_ngcontent-%COMP%]{text-align:right}mat-dialog-actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;padding:16px}mat-dialog-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-left:8px}"]});let e=r;return e})();var De=(()=>{let r=class r{constructor(){this.stationId=null,this.date=null,this.stationTitle=null}setFilters(t,i,n){this.stationId=t,this.date=i,this.stationTitle=n}getFilters(){return this.stationId&&this.date&&this.stationTitle?{stationId:this.stationId,date:this.date,stationTitle:this.stationTitle}:null}clearFilters(){this.stationId=null,this.date=null,this.stationTitle=null}};r.\u0275fac=function(i){return new(i||r)},r.\u0275prov=ct({token:r,factory:r.\u0275fac,providedIn:"root"});let e=r;return e})();var Ge=["goUp"],Oe=e=>({disabled:e});function ze(e,r){e&1&&(c(0,"mat-label"),m(1,"\u0627\u062E\u062A\u0631 \u0645\u062D\u0637\u0629"),s())}function He(e,r){if(e&1&&(c(0,"mat-label"),m(1),s()),e&2){let o=u();l(),T(" ",o.stationTitle,"")}}function We(e,r){if(e&1&&(c(0,"mat-option",18,2),m(2),s()),e&2){let o=r.$implicit;d("value",o),l(2),T(" ",o.title," ")}}function Qe(e,r){if(e&1&&(c(0,"th",39),m(1),Lt(2,"translate"),s()),e&2){let o=u(2).$implicit;l(),T(" ",$t(2,1,o)," ")}}function Je(e,r){if(e&1&&(c(0,"td",40),m(1),s()),e&2){let o=r.$implicit,t=u(2).$implicit;l(),T(" ",o[t]," ")}}function Ke(e,r){if(e&1&&(V(0,36),f(1,Qe,3,3,"th",37)(2,Je,2,1,"td",38),D()),e&2){let o=u().$implicit;d("matColumnDef",o)}}function Xe(e,r){e&1&&(c(0,"th",43),m(1," \u0627\u0644\u0625\u062C\u0631\u0627\u0621\u0627\u062A "),s())}function Ye(e,r){if(e&1){let o=R();c(0,"td",40)(1,"button",44),v("click",function(){let i=C(o).$implicit,n=u(3);return h(n.editElement(i))}),c(2,"mat-icon"),m(3,"edit"),s()(),c(4,"button",45),v("click",function(){let i=C(o).$implicit,n=u(3);return h(n.deleteElement(i))}),c(5,"mat-icon"),m(6,"delete"),s()()()}}function Ze(e,r){e&1&&(V(0)(1,41),f(2,Xe,2,0,"th",42)(3,Ye,7,0,"td",38),D()())}function tn(e,r){if(e&1&&(V(0),f(1,Ke,3,1,"ng-container",34)(2,Ze,4,0,"ng-container",35),D()),e&2){let o=r.last;l(),d("ngIf",!o),l(),d("ngIf",o)}}function en(e,r){e&1&&I(0,"tr",46)}function nn(e,r){e&1&&I(0,"tr",47)}function on(e,r){if(e&1&&(c(0,"div",48)(1,"span",49),m(2),s(),c(3,"span",50),m(4),s()()),e&2){let o=r.$implicit;l(2),x(o.name),l(2),x(o.value)}}function an(e,r){if(e&1&&(c(0,"div",48)(1,"span",49),m(2),s(),c(3,"span",50),m(4),s()()),e&2){let o=r.$implicit;l(2),x(o.name),l(2),x(o.value)}}var Fe=(()=>{let r=class r{constructor(t,i,n,a,p,_,g){this.liveAnnouncer=t,this.stationMonitorProviderService=i,this.snackBarService=n,this.dialog=a,this.router=p,this.filterService=_,this.cd=g,this.stationMonitor=[],this.stations=[],this.dateTime=new Date,this.accessCellSums=[],this.stationAmpereSums=[],this.stationTitle=null,this.stationId=0,this.isSelectedStation=!1,this.isLoading=!1,this.dataSource=new ve([]),this.displayedColumns=[],this.displayDynamicColumns=[],this.displayMode=O.All,this.displayModes=O,this.subscriptions=[]}ngOnInit(){this.loadStations();let t=this.filterService.getFilters();t!==null&&(this.isSelectedStation=!0,this.stationId=t.stationId,this.dateTime=new Date(t.date),this.stationTitle=t.stationTitle,this.loadData(this.stationId,this.formatDateSpecial(this.dateTime?.toString())),this.filterService.clearFilters())}ngOnDestroy(){this.subscriptions.forEach(t=>t.unsubscribe())}loadStations(){let t=this.stationMonitorProviderService.getStation(Te.Stations).subscribe(i=>{this.stations=i});this.subscriptions.push(t)}loadData(t,i){this.isLoading=!0;let n=this.stationMonitorProviderService.getStationMonitors(t,i).subscribe(a=>{Array.isArray(a)&&a.length>0?(this.processMonitorData(a),this.updateDisplayedColumns()):(this.stationMonitor=[],this.dataSource.data=[],this.updateDisplayedColumns(),this.snackBarService.showSuccess("No data available for the selected station and date.")),this.isLoading=!1,this.cd.detectChanges()},a=>{this.isLoading=!1,this.snackBarService.showSuccess("Failed to load data. Please try again.")});this.subscriptions.push(n)}processMonitorData(t){let i=n=>n?wt(n,"HH","en-GB"):"";this.stationMonitor=t.map(n=>({entryDate:i(n.entryDate),monitorId:n.monitorId,voltage66kV:n.voltage66kV,reactivePower:n.reactivePower,stationRelationRecords:n.stationRelationRecordDtos?.map(a=>({station:a.station,ampere:a.ampere}))||[],stationAccessCellRecords:n.stationAccessCellDtos?.map(a=>({accessCellNumber:a.accessCellNumber,accessCellValue:a.accessCellValue}))||[],transformerRecords:n.transformerMonitoringDtos?.map(a=>({transformer:a.transformer,ampere:a.ampere,Voltage20kV:a.ampere}))||[],isExpanded:!1})),this.accessCellSums=this.getAccessData(this.stationMonitor),this.stationAmpereSums=this.getStationAmpereData(this.stationMonitor)}updateDisplayedColumns(){let t=this.getUniqueStations(),i=this.getUniqueAccessCells(),n=this.getUniqueTransformers();switch(this.displayMode){case O.All:this.displayDynamicColumns=[...t,...i,...n];break;case O.OnlyTransformers:this.displayDynamicColumns=n;break;case O.WithoutStationsAccess:this.displayDynamicColumns=[...t,...n];break;case O.WithoutTransformers:this.displayDynamicColumns=[...t,...i];break}this.displayedColumns=["entryDate",...this.displayMode===O.OnlyTransformers?this.displayDynamicColumns:["voltage66kV","reactivePower",...this.displayDynamicColumns],"action"],this.displayedColumns=Array.from(new Set(this.displayedColumns));let a=this.stationMonitor.map(p=>K(K({},p),this.getRecordData(p,t,i,n)));this.dataSource.data=a,console.log(this.dataSource.data),this.dataSource.sort=this.sort}getUniqueStations(){return Array.from(new Set(this.stationMonitor.flatMap(t=>t.stationRelationRecords?.map(i=>i.station?.toString())||[])))}getUniqueAccessCells(){return Array.from(new Set(this.stationMonitor.flatMap(t=>t.stationAccessCellRecords?.map(i=>i.accessCellNumber?.toString())||[])))}getUniqueTransformers(){return Array.from(new Set(this.stationMonitor.flatMap(t=>t.transformerRecords?.map(i=>i.transformer?.toString())||[])))}getRecordData(t,i,n,a){let p=i.reduce((A,P)=>{let F=t.stationRelationRecords?.find(ot=>ot.station===P);return A[P]=F?F.ampere?.toString():"",A},{}),_=n.reduce((A,P)=>{let F=t.stationAccessCellRecords?.find(ot=>ot.accessCellNumber?.toString()===P);return A[P]=F?F.accessCellValue?.toString():"",A},{}),g=a.reduce((A,P)=>{let F=t.transformerRecords?.find(ot=>ot.transformer?.toString()===P);return A[P]=F?F.ampere?.toString():"",A},{});return K(K(K({},p),_),g)}onStationChange(t){this.isSelectedStation=!0,this.stationId=t.value.id,this.stationTitle=t.value.title,this.fetchData()}announceSortChange(t){let i=t.direction?`Sorted ${t.direction}ending`:"Sorting cleared";this.liveAnnouncer.announce(i)}fetchData(){this.loadData(this.stationId,this.formatDateSpecial(this.dateTime?.toString()))}onDateChange(t){this.isSelectedStation&&t&&t.value?(this.dateTime=new Date(t.value),this.fetchData()):console.error("Invalid date value from event")}getNextDay(){this.dateTime instanceof Date&&!isNaN(this.dateTime.getTime())?(this.dateTime=this.addDays(1,this.dateTime),this.fetchData(),this.scrollToCard()):(console.error("Invalid dateTime value:",this.dateTime),this.snackBarService.showSuccess("Error: Invalid date value."))}getPreviousDay(){this.dateTime instanceof Date&&!isNaN(this.dateTime.getTime())?(this.dateTime=this.addDays(-1,this.dateTime),this.fetchData(),this.scrollToCard()):(console.error("Invalid dateTime value:",this.dateTime),this.snackBarService.showSuccess("Error: Invalid date value."))}addDays(t,i){let n=new Date(i);return n.setDate(n.getDate()+t),n}formatDateSpecial(t){return wt(t,"yyyy-MM-dd","en-GB")}scrollToCard(){let t=document.getElementById("goUp");t&&t.scrollIntoView({behavior:"smooth",block:"start"})}getAccessData(t){if(!t||t.length===0)return[];let i=t.reduce((a,p)=>(p.stationAccessCellRecords?.forEach(_=>{let g=`\u062E\u0644\u064A\u0629 ${_.accessCellNumber}`;a[g]=(a[g]||0)+_.accessCellValue}),a),{});return Object.entries(i).map(([a,p])=>({name:a,value:parseFloat(p.toFixed(2))}))}getStationAmpereData(t){let i=t.reduce((a,p)=>(p.stationRelationRecords?.forEach(_=>{a[_.station]=(a[_.station]||0)+_.ampere}),a),{});return Object.entries(i).map(([a,p])=>({name:a,value:parseFloat(p.toFixed(3))}))}chooseStation(){let t=this.dialog.open(Ve,{data:{stations:this.stations},width:"350px",disableClose:!0,height:"300px"})}editElement(t){this.filterService.setFilters(this.stationId,this.formatDateSpecial(this.dateTime?.toString()),this.stationTitle),this.router.navigate(["/station-monitor/update"],{queryParams:{monitorId:t.monitorId,stationId:this.stationId}})}deleteElement(t){this.dialog.open(we,{data:{id:t.monitorId}}).afterClosed().subscribe(n=>{n&&this.stationMonitorProviderService.deleteStationMonitor(t.monitorId).subscribe({next:()=>{this.dataSource.data=this.dataSource.data.filter(a=>a.monitorId!==t.monitorId),this.snackBarService.showSuccess("\u062A\u0645 \u0627\u0644\u062D\u0630\u0641 \u0628\u0646\u062C\u0627\u062D")},error:a=>{this.snackBarService.showError(`\u062D\u062F\u062B \u062E\u0637\u0623 \u0623\u062B\u0646\u0627\u0621 \u0627\u0644\u062D\u0630\u0641: ${a.message||a}`)},complete:()=>{this.stationMonitor=this.stationMonitor.filter(a=>a.monitorId!==t.monitorId),this.accessCellSums=this.getAccessData(this.stationMonitor),this.stationAmpereSums=this.getStationAmpereData(this.stationMonitor)}})})}};r.\u0275fac=function(i){return new(i||r)(b(Jt),b(H),b(z),b(yt),b(Z),b(De),b(Gt))},r.\u0275cmp=N({type:r,selectors:[["app-station-monitor-table"]],viewQuery:function(i,n){if(i&1&&(Rt(Mt,5),Rt(Ge,5)),i&2){let a;Tt(a=Et())&&(n.sort=a.first),Tt(a=Et())&&(n.goUpCard=a.first)}},standalone:!0,features:[jt([{provide:Kt,useValue:"en-GB"}]),U],decls:61,vars:25,consts:[["inputDateTime",""],["picker",""],["dropMenuOption",""],["id","goUp"],[1,"header-content"],[1,"details-table"],[1,"station-drop-down","style-header"],["appearance","fill",1,"add-station-select"],[3,"selectionChange"],[3,"value",4,"ngFor","ngForOf"],[1,"date-input","style-header"],["matInput","",3,"ngModelChange","dateChange","matDatepicker","ngModel"],["matIconSuffix","",3,"for"],[1,"btn-get-data"],["mat-raised-button","","color","primary",3,"click","disabled"],[1,"btn-add-data"],["mat-icon-button","","color","accent",3,"click"],[3,"ngModelChange","ngModel"],[3,"value"],[1,"tables-container"],[1,"table-wrapper"],["mat-table","","matSort","",1,"mat-elevation-z8",2,"border-radius","10px",3,"matSortChange","dataSource"],[4,"ngFor","ngForOf"],["mat-header-row","","style","background-color: #194659; color: white;",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],[1,"footer-btn"],["matTooltip","\u0627\u0644\u064A\u0648\u0645 \u0627\u0644\u0633\u0627\u0628\u0642","mat-button","",1,"prev-btn",3,"click","disabled","ngClass"],["matTooltip","\u0627\u0644\u064A\u0648\u0645 \u0627\u0644\u062A\u0627\u0644\u064A","mat-button","",1,"next-btn",3,"click","disabled","ngClass"],[1,"footer-content"],[1,"footer-section"],[1,"section-title"],[1,"section-items"],["class","footer-item",4,"ngFor","ngForOf"],[3,"isLoading"],[3,"matColumnDef",4,"ngIf"],[4,"ngIf"],[3,"matColumnDef"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["mat-header-cell","","mat-sort-header",""],["mat-cell",""],["matColumnDef","action"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-header-cell",""],["mat-icon-button","",3,"click"],["mat-icon-button","",2,"color","red",3,"click"],["mat-header-row","",2,"background-color","#194659","color","white"],["mat-row",""],[1,"footer-item"],[1,"item-name"],[1,"item-value"]],template:function(i,n){if(i&1){let a=R();c(0,"mat-card",3)(1,"mat-card-header")(2,"div",4),I(3,"div",5),c(4,"div",6)(5,"mat-form-field",7),f(6,ze,2,0,"mat-label")(7,He,2,1,"mat-label"),c(8,"mat-select",8),v("selectionChange",function(_){return C(a),h(n.onStationChange(_))}),f(9,We,3,2,"mat-option",9),s()()(),c(10,"div",10)(11,"mat-form-field")(12,"mat-label"),m(13,"\u0627\u062E\u062A\u0631 \u062A\u0627\u0631\u064A\u062E"),s(),c(14,"input",11,0),lt("ngModelChange",function(_){return C(a),rt(n.dateTime,_)||(n.dateTime=_),h(_)}),v("dateChange",function(){C(a);let _=w(15);return h(n.onDateChange(_.value))}),s(),I(16,"mat-datepicker-toggle",12)(17,"mat-datepicker",null,1),s()(),c(19,"div",13)(20,"button",14),v("click",function(){return C(a),h(n.fetchData())}),m(21," \u062A\u062D\u062F\u064A\u062B "),s()()()(),c(22,"div",15)(23,"button",16),v("click",function(){return C(a),h(n.chooseStation())}),c(24,"mat-icon"),m(25,"add"),s()(),c(26,"div")(27,"mat-radio-group",17),lt("ngModelChange",function(_){return C(a),rt(n.displayMode,_)||(n.displayMode=_),h(_)}),c(28,"mat-radio-button",18),m(29,"\u0639\u0631\u0636 \u0627\u0644\u0643\u0644"),s(),c(30,"mat-radio-button",18),m(31,"\u0628\u062F\u0648\u0646 \u0645\u062D\u0648\u0644\u0627\u062A"),s(),c(32,"mat-radio-button",18),m(33,"\u0645\u062D\u0648\u0644\u0627\u062A \u0641\u0642\u0637"),s()()()(),c(34,"mat-card-content")(35,"div",19)(36,"div",20)(37,"table",21),v("matSortChange",function(_){return C(a),h(n.announceSortChange(_))}),f(38,tn,3,2,"ng-container",22)(39,en,1,0,"tr",23)(40,nn,1,0,"tr",24),s()()(),c(41,"div",25)(42,"button",26),v("click",function(){return C(a),h(n.getPreviousDay())}),c(43,"mat-icon"),m(44,"arrow_forward"),s()(),c(45,"button",27),v("click",function(){return C(a),h(n.getNextDay())}),c(46,"mat-icon"),m(47,"arrow_back"),s()()()(),c(48,"mat-card-footer")(49,"div",28)(50,"div",29)(51,"div",30),m(52,"\u0645\u062C\u0645\u0648\u0639 \u0642\u064A\u0645\u0629 \u062E\u0644\u0627\u064A\u0627 \u0627\u0644\u0648\u0635\u0648\u0644:"),s(),c(53,"div",31),f(54,on,5,2,"div",32),s()(),c(55,"div",29)(56,"div",30),m(57,"\u0645\u062C\u0645\u0648\u0639 \u0627\u0644\u062A\u0623\u062B\u064A\u0631\u0627\u062A \u0644\u0643\u0644 \u062E\u0637:"),s(),c(58,"div",31),f(59,an,5,2,"div",32),s()()()(),I(60,"app-loading-spinner",33),s()}if(i&2){let a=w(18);l(6),Bt(n.stationTitle===null?6:7),l(3),d("ngForOf",n.stations),l(5),d("matDatepicker",a),at("ngModel",n.dateTime),l(2),d("for",a),l(4),d("disabled",!n.isSelectedStation),l(7),at("ngModel",n.displayMode),l(),d("value",n.displayModes.All),l(2),d("value",n.displayModes.WithoutTransformers),l(2),d("value",n.displayModes.OnlyTransformers),l(5),d("dataSource",n.dataSource),l(),d("ngForOf",n.displayedColumns),l(),d("matHeaderRowDef",n.displayedColumns),l(),d("matRowDefColumns",n.displayedColumns),l(2),d("disabled",!n.isSelectedStation)("ngClass",y(21,Oe,!n.isSelectedStation)),l(3),d("disabled",!n.isSelectedStation)("ngClass",y(23,Oe,!n.isSelectedStation)),l(9),d("ngForOf",n.accessCellSums),l(5),d("ngForOf",n.stationAmpereSums),l(),d("isLoading",n.isLoading)}},dependencies:[G,X,q,Y,xe,L,j,Yt,ce,me,fe,ue,de,ge,pe,_e,Ce,he,Mt,Se,tt,Xt,Zt,ae,re,se,le,ne,et,nt,pt,Ae,Ie,Re,$,B,ie,oe,ee,te,it],styles:[".header-content[_ngcontent-%COMP%]{width:100%;display:flex;justify-content:space-between;align-items:center}.style-header[_ngcontent-%COMP%], .btn-get-data[_ngcontent-%COMP%]{margin-top:10px}.btn-add-data[_ngcontent-%COMP%]{margin-top:20px;padding:16px}.btn-add-data[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin:0;padding:8px;transition:transform .3s ease,box-shadow .3s ease}.btn-add-data[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{transform:scale(1.1);box-shadow:0 4px 8px #0003}.btn-add-data[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{margin-top:5px}.btn-transforms-data[_ngcontent-%COMP%]{background-color:transparent;border:none}.btn-transforms-data[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{margin-right:5px;font-size:18px}.footer-btn[_ngcontent-%COMP%]{display:flex;justify-content:space-between;padding:10px}.footer-btn[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{background-color:#007bff;color:#fff;border:none;padding:10px 20px;font-size:16px;cursor:pointer;border-radius:5px;display:flex;align-items:center;transition:background-color .3s}.footer-btn[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:24px}.footer-btn[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{background-color:#0056b3}.footer-btn[_ngcontent-%COMP%]   button.prev-btn[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{margin-right:8px;width:100%;margin-top:-5px}.footer-btn[_ngcontent-%COMP%]   button.next-btn[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{margin-right:8px;width:100%;margin-top:-5px}.footer-btn[_ngcontent-%COMP%]   .disabled[_ngcontent-%COMP%]{background-color:#e1dfe4}mat-card-footer[_ngcontent-%COMP%]{display:flex;flex-direction:column;padding:16px;background-color:#f8f8f8;border-top:1px solid #ddd}mat-card-footer[_ngcontent-%COMP%]   .footer-content[_ngcontent-%COMP%]{display:flex;flex-direction:column}mat-card-footer[_ngcontent-%COMP%]   .footer-content[_ngcontent-%COMP%]   .total-reactive-power[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;padding:8px;border:1px solid #ddd;border-radius:4px;background-color:#fff;font-weight:700;font-size:1.2em;margin-bottom:16px;width:30%}mat-card-footer[_ngcontent-%COMP%]   .footer-content[_ngcontent-%COMP%]   .total-reactive-power[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]{text-align:center;margin-left:8px;font-size:1.2em}mat-card-footer[_ngcontent-%COMP%]   .footer-content[_ngcontent-%COMP%]   .footer-section[_ngcontent-%COMP%]{margin-bottom:16px;display:flex;flex-direction:column}mat-card-footer[_ngcontent-%COMP%]   .footer-content[_ngcontent-%COMP%]   .footer-section[_ngcontent-%COMP%]   .section-title[_ngcontent-%COMP%]{font-weight:700;margin-bottom:8px;font-size:1.1em}mat-card-footer[_ngcontent-%COMP%]   .footer-content[_ngcontent-%COMP%]   .footer-section[_ngcontent-%COMP%]   .section-items[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:16px}mat-card-footer[_ngcontent-%COMP%]   .footer-content[_ngcontent-%COMP%]   .footer-section[_ngcontent-%COMP%]   .section-items[_ngcontent-%COMP%]   .footer-item[_ngcontent-%COMP%]{display:flex;flex-direction:row;align-items:center;padding:8px;border:1px solid #ddd;border-radius:4px;background-color:#fff;width:150px;justify-content:space-between}mat-card-footer[_ngcontent-%COMP%]   .footer-content[_ngcontent-%COMP%]   .footer-section[_ngcontent-%COMP%]   .section-items[_ngcontent-%COMP%]   .footer-item[_ngcontent-%COMP%]   .item-name[_ngcontent-%COMP%]{font-weight:700;color:#333}mat-card-footer[_ngcontent-%COMP%]   .footer-content[_ngcontent-%COMP%]   .footer-section[_ngcontent-%COMP%]   .section-items[_ngcontent-%COMP%]   .footer-item[_ngcontent-%COMP%]   .item-value[_ngcontent-%COMP%]{color:#555}.mat-mdc-header-cell.mat-column-action[_ngcontent-%COMP%]{text-align:center}td.mat-cell[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center}.btn-delete-data[_ngcontent-%COMP%]{color:#f44336;margin-right:5px}.btn-delete-data[_ngcontent-%COMP%]:hover{background-color:#f443361a}.btn-transforms-data[_ngcontent-%COMP%]{margin-right:8px}.btn-delete-data[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{margin-right:8px}.tables-container[_ngcontent-%COMP%]   .expanded-detail[_ngcontent-%COMP%]{padding:16px;font-size:14px}.table-wrapper[_ngcontent-%COMP%]{overflow-x:auto;width:100%}.table-wrapper[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]{min-width:100%}"],data:{animation:[Ht("detailExpand",[Vt("collapsed",kt({height:"0px",minHeight:"0"})),Vt("expanded",kt({height:"*"})),Qt("expanded <=> collapsed",Wt("225ms cubic-bezier(0.4, 0.0, 0.2, 1)"))])]}});let e=r;return e})();var Q=e=>({"is-invalid":e}),Ne=(e,r)=>({formArray:e,index:r,field:"ampere"}),rn=(e,r)=>({formArray:e,index:r,field:"accessCellValue"}),ln=(e,r)=>({formArray:e,index:r,field:"voltage22kV"}),sn=(e,r)=>({formArray:e,index:r,field:"accessCellId"}),cn=(e,r)=>({formArray:e,index:r,field:"reactivePower"});function dn(e,r){e&1&&E(0)}function mn(e,r){if(e&1){let o=R();c(0,"div",17)(1,"label"),m(2),s(),I(3,"input",18),c(4,"div",8)(5,"label",19),m(6,"\u0627\u0644\u0623\u0645\u0628\u064A\u0631"),s(),c(7,"input",20),v("click",function(){let i=C(o).index,n=u(2);return h(n.clearValue(i,n.stationRelationRecords,"ampere"))}),s(),f(8,dn,1,0,"ng-container",21),s()()}if(e&2){let o=r.index,t=u(2),i=w(27);d("formGroupName",o),l(2),x(t.stationRecords[o].title||"\u0627\u0644\u0639\u0646\u0648\u0627\u0646 \u063A\u064A\u0631 \u0645\u062A\u0648\u0641\u0631"),l(3),M("for","ampere-station-",o,""),l(2),M("id","ampere-station-",o,""),d("ngClass",y(9,Q,t.isFieldInvalid(t.stationRelationRecords,o,"ampere"))),l(),d("ngTemplateOutlet",i)("ngTemplateOutletContext",k(11,Ne,t.stationRelationRecords,o))}}function un(e,r){if(e&1&&(V(0),c(1,"div",15)(2,"h3",5),m(3,"\u0633\u062C\u0644\u0627\u062A \u0627\u0644\u0645\u062D\u0637\u0627\u062A"),s(),f(4,mn,9,14,"div",16),s(),D()),e&2){let o=u();l(4),d("ngForOf",o.stationRelationRecords.controls)("ngForTrackBy",o.trackByIndex)}}function pn(e,r){if(e&1&&(c(0,"small",23),m(1),s()),e&2){let o=u(2);l(),x(o.validationMessage.min)}}function _n(e,r){if(e&1&&(c(0,"small",23),m(1),s()),e&2){let o=u(2);l(),T(" ",o.validationMessage.required,"")}}function fn(e,r){if(e&1&&(c(0,"small",23),m(1),s()),e&2){let o=u(2);l(),x(o.validationMessage.pattern)}}function gn(e,r){if(e&1&&(c(0,"div"),f(1,pn,2,1,"small",22)(2,_n,2,1,"small",22)(3,fn,2,1,"small",22),s()),e&2){let o,t,i,n=u();l(),d("ngIf",(o=n.form.get("voltage60kV"))==null?null:o.hasError("min")),l(),d("ngIf",(t=n.form.get("voltage60kV"))==null?null:t.hasError("required")),l(),d("ngIf",(i=n.form.get("voltage60kV"))==null?null:i.hasError("pattern"))}}function Cn(e,r){if(e&1&&(c(0,"small",23),m(1),s()),e&2){let o=u(2);l(),x(o.validationMessage.required)}}function hn(e,r){if(e&1&&(c(0,"small",23),m(1),s()),e&2){let o=u(2);l(),x(o.validationMessage.pattern)}}function vn(e,r){if(e&1&&(c(0,"div"),f(1,Cn,2,1,"small",22)(2,hn,2,1,"small",22),s()),e&2){let o,t,i=u();l(),d("ngIf",(o=i.form.get("reactivePower"))==null?null:o.hasError("required")),l(),d("ngIf",(t=i.form.get("reactivePower"))==null?null:t.hasError("pattern"))}}function xn(e,r){e&1&&E(0)}function Sn(e,r){if(e&1&&(c(0,"small",23),m(1),s()),e&2){let o=u(3);l(),x(o.validationMessage.min)}}function bn(e,r){e&1&&E(0)}function Mn(e,r){if(e&1){let o=R();c(0,"div",17)(1,"div",25)(2,"div",26)(3,"label")(4,"input",27),v("change",function(i){let n=C(o).index,a=u(2);return h(a.onCheckboxChange(n,i))}),s(),m(5),s()(),I(6,"input",28),c(7,"div",29)(8,"div",7)(9,"label",30),m(10,"\u0627\u0644\u0642\u064A\u0645\u0629"),s(),c(11,"input",31),v("click",function(){let i=C(o).index,n=u(2);return h(n.clearValue(i,n.stationAccessCell,"accessCellValue"))}),s(),f(12,xn,1,0,"ng-container",21),s(),c(13,"div",7)(14,"label",30),m(15,"\u0627\u0644\u062C\u0647\u062F"),s(),c(16,"input",32),v("click",function(){let i=C(o).index,n=u(2);return h(n.clearValue(i,n.stationAccessCell,"voltage22kV"))}),s(),f(17,Sn,2,1,"small",22)(18,bn,1,0,"ng-container",21),s()()()()}if(e&2){let o,t,i,n,a,p=r.$implicit,_=r.index,g=u(2),A=w(27);d("formGroupName",_),l(4),d("checked",!0),l(),T(" \u062E\u0644\u064A\u0629 \u0627\u0644\u0648\u0635\u0648\u0644 \u0631\u0642\u0645 ",p.value.accessCellNumber," "),l(4),M("for","accessCellValue-",(o=p.get("accessCellNumber"))==null?null:o.value,""),l(2),M("id","accessCellValue-",(t=p.get("accessCellNumber"))==null?null:t.value,""),d("disabled",g.isDisabled(_))("ngClass",y(20,Q,g.isFieldInvalid(g.stationAccessCell,_,"accessCellValue"))),l(),d("ngTemplateOutlet",A)("ngTemplateOutletContext",k(22,rn,g.stationAccessCell,_)),l(2),M("for","voltage22kV-",(i=p.get("accessCellNumber"))==null?null:i.value,""),l(2),M("id","voltage22kV-",(n=p.get("accessCellNumber"))==null?null:n.value,""),d("disabled",g.isDisabled(_))("ngClass",y(25,Q,g.isFieldInvalid(g.stationAccessCell,_,"voltage22kV"))),l(),d("ngIf",(a=g.stationAccessCell.at(_).get("voltage22kV"))==null?null:a.hasError("min")),l(),d("ngTemplateOutlet",A)("ngTemplateOutletContext",k(27,ln,g.stationAccessCell,_))}}function yn(e,r){if(e&1&&(V(0),c(1,"div",24)(2,"h3"),m(3,"\u0633\u062C\u0644\u0627\u062A \u0627\u0644\u0648\u0635\u0648\u0644 \u0625\u0644\u0649 \u0627\u0644\u062E\u0644\u0627\u064A\u0627"),s(),f(4,Mn,19,30,"div",16),s(),D()),e&2){let o=u();l(4),d("ngForOf",o.stationAccessCell.controls)("ngForTrackBy",o.trackByIndex)}}function An(e,r){if(e&1&&(c(0,"mat-option",39),m(1),s()),e&2){let o=r.$implicit;d("value",o.accessCellId),l(),T(" ",o.accessCellNumber," ")}}function In(e,r){e&1&&E(0)}function Rn(e,r){e&1&&E(0)}function Tn(e,r){e&1&&E(0)}function En(e,r){if(e&1){let o=R();c(0,"div",17)(1,"label"),m(2),s(),I(3,"input",18),c(4,"div",34)(5,"div",35)(6,"mat-form-field",36)(7,"mat-label"),m(8,"\u0627\u062E\u062A\u0631 \u0627\u0644\u062E\u0644\u064A\u0629"),s(),c(9,"mat-select",37),v("click",function(){let i=C(o).index,n=u(2);return h(n.clearValue(i,n.transformerRelationRecords,"accessCellId"))})("selectionChange",function(i){let n=C(o).index,a=u(2);return h(a.onSelectionChange(i,n))}),f(10,An,2,2,"mat-option",38),s()(),f(11,In,1,0,"ng-container",21),s(),c(12,"div",7)(13,"label",19),m(14,"\u0627\u0644\u0623\u0645\u0628\u064A\u0631"),s(),c(15,"input",20),v("click",function(){let i=C(o).index,n=u(2);return h(n.clearValue(i,n.transformerRelationRecords,"ampere"))}),s(),f(16,Rn,1,0,"ng-container",21),s(),c(17,"div",35),f(18,Tn,1,0,"ng-container",21),s()()()}if(e&2){let o=r.index,t=u(2),i=w(27),n=w(29);d("formGroupName",o),l(2),x(t.transformerRecords[o].title||"\u0627\u0644\u0639\u0646\u0648\u0627\u0646 \u063A\u064A\u0631 \u0645\u062A\u0648\u0641\u0631"),l(7),M("id","accessCellNumber-",o,""),d("ngClass",y(17,Q,t.isFieldInvalid(t.transformerRelationRecords,o,"accessCellId"))),l(),d("ngForOf",t.accessCellsRecordData),l(),d("ngTemplateOutlet",n)("ngTemplateOutletContext",k(19,sn,t.transformerRelationRecords,o)),l(2),M("for","ampere-transformer-",o,""),l(2),M("id","ampere-transformer-",o,""),d("ngClass",y(22,Q,t.isFieldInvalid(t.transformerRelationRecords,o,"ampere"))),l(),d("ngTemplateOutlet",i)("ngTemplateOutletContext",k(24,Ne,t.transformerRelationRecords,o)),l(2),d("ngTemplateOutlet",i)("ngTemplateOutletContext",k(27,cn,t.transformerRelationRecords,o))}}function wn(e,r){if(e&1&&(V(0),c(1,"div",33)(2,"h3"),m(3,"\u0633\u062C\u0644\u0627\u062A \u0627\u0644\u0645\u062D\u0648\u0644\u0627\u062A"),s(),f(4,En,19,30,"div",16),s(),D()),e&2){let o=u();l(4),d("ngForOf",o.transformerRelationRecords.controls)("ngForTrackBy",o.trackByIndex)}}function kn(e,r){if(e&1&&(c(0,"small",23),m(1),s()),e&2){let o=u(3);l(),x(o.validationMessage.required)}}function Vn(e,r){if(e&1&&(c(0,"small",23),m(1),s()),e&2){let o=u(3);l(),x(o.validationMessage.pattern)}}function Dn(e,r){if(e&1&&(c(0,"div",41),f(1,kn,2,1,"small",22)(2,Vn,2,1,"small",22),s()),e&2){let o=u(),t=o.formArray,i=o.index,n=o.field,a=u();l(),d("ngIf",a.hasFieldError(t,i,n,"required")),l(),d("ngIf",a.hasFieldError(t,i,n,"pattern"))}}function On(e,r){if(e&1&&f(0,Dn,3,2,"div",40),e&2){let o=r.formArray,t=r.index,i=r.field,n=u();d("ngIf",n.isFieldInvalid(o,t,i))}}function Pn(e,r){if(e&1&&(c(0,"small",23),m(1),s()),e&2){let o=u(3);l(),x(o.validationMessage.required)}}function Fn(e,r){if(e&1&&(c(0,"small",23),m(1),s()),e&2){let o=u(3);l(),x(o.validationMessage.pattern)}}function Nn(e,r){if(e&1&&(c(0,"small",43),m(1),s()),e&2){let o=u(3);l(),x(o.validationMessage.rangeError)}}function Un(e,r){if(e&1&&(c(0,"div",41),f(1,Pn,2,1,"small",22)(2,Fn,2,1,"small",22)(3,Nn,2,1,"small",42),s()),e&2){let o=u(),t=o.formArray,i=o.index,n=o.field,a=u();l(),d("ngIf",a.hasFieldError(t,i,n,"required")),l(),d("ngIf",a.hasFieldError(t,i,n,"pattern")),l(),d("ngIf",a.hasFieldError(t,i,n,"rangeError"))}}function qn(e,r){if(e&1&&f(0,Un,4,3,"div",40),e&2){let o=r.formArray,t=r.index,i=r.field,n=u();d("ngIf",n.isFieldInvalid(o,t,i))}}var Ue=(()=>{let r=class r{constructor(t,i,n,a){this.stationMonitorService=t,this.snackBarService=i,this.route=n,this.fb=a,this.validationMessage={required:"\u064A\u062C\u0628 \u0625\u062F\u062E\u0627\u0644 \u0642\u064A\u0645\u0629.",min:"\u0627\u0644\u062C\u0647\u062F \u0644\u0627 \u064A\u0645\u0643\u0646 \u0623\u0646 \u064A\u0643\u0648\u0646 \u0633\u0627\u0644\u0628 \u0623\u0648 \u0635\u0641\u0631.",pattern:"\u064A\u062C\u0628 \u0623\u0646 \u062A\u0643\u0648\u0646 \u0627\u0644\u0642\u064A\u0645\u0629 \u0639\u062F\u062F\u064B\u0627 \u0635\u062D\u064A\u062D\u064B\u0627 \u0623\u0648 \u0639\u062F\u062F\u064B\u0627 \u0639\u0634\u0631\u064A\u064B\u0627.",rangeError:"\u064A\u062C\u0628 \u0623\u0646 \u064A\u0643\u0648\u0646 \u0631\u0642\u0645 \u0627\u0644\u062E\u0644\u064A\u0629 \u0645\u0637\u0627\u0628\u0642\u064B\u0627 \u0644\u0631\u0642\u0645 \u0623\u062D\u062F \u0627\u0644\u062E\u0644\u0627\u064A\u0627.",twoDecimalNumbers:"\u064A\u062C\u0628 \u0623\u0646 \u064A\u0643\u0648\u0646 \u0631\u0642\u0645\u064B\u0627 \u0635\u062D\u064A\u062D\u064B\u0627 \u0645\u0639 \u062E\u0627\u0646\u062A\u064A\u0646 \u0639\u0634\u0631\u064A\u062A\u064A\u0646 \u0643\u062D\u062F \u0623\u0642\u0635\u0649."},this.disabledIndexes=new Set,this.singleActiveIndex=0,this.activeAccessCellNumber=[],this.isLoading=!1,this.stationRecords=[],this.transformerRecords=[],this.accessCellsRecordData=[],this.firstAccessCellNumber=0,this.form=this.fb.group({stationRelationRecords:this.fb.array([]),transformerRelationRecords:this.fb.array([]),stationAccessCell:this.fb.array([]),voltage60kV:[null,[S.required,S.pattern(/^\d+(\.\d{1,2})?$/),S.min(1)]],reactivePower:[null,[S.required,S.pattern(/^\d+(\.\d{1,2})?$/)]]})}ngOnInit(){this.isLoading=!0,this.stationId=Number(this.route.snapshot.paramMap.get("id")),this.loadFormPostData()}loadFormPostData(){this.stationMonitorService.getFormData(this.stationId).subscribe({next:t=>{this.stationFormData=t,this.entryDate=this.stationFormData.entryDate,this.stationFormData.stationRecordData.length>0&&(this.stationRecords=this.stationFormData.stationRecordData,this.addStationRelationRecords()),this.stationFormData.accessCellsRecordData.length>0&&(this.accessCellsRecordData=this.stationFormData.accessCellsRecordData,this.addStationAccessCells()),this.stationFormData.transformerRecordData.length>0&&(this.transformerRecords=this.stationFormData.transformerRecordData,this.addTransformerRelationRecords()),this.isLoading=!1},error:t=>{let i=`\u062D\u062F\u062B \u062E\u0637\u0623 \u0645\u0627 
 ${t.error}`;this.isLoading=!1,this.snackBarService.showError(i)}})}get stationRelationRecords(){return this.form.get("stationRelationRecords")}get transformerRelationRecords(){return this.form.get("transformerRelationRecords")}get stationAccessCell(){return this.form.get("stationAccessCell")}addStationAccessCells(){this.accessCellsRecordData.forEach(t=>{this.stationAccessCell.push(this.fb.group({accessCellId:[t.accessCellId],accessCellNumber:[t.accessCellNumber],voltage22kV:[0,[S.required,S.pattern(/^\d+(\.\d{1,2})?$/),S.min(1)]],accessCellValue:[0,[S.required,S.pattern(/^\d+(\.\d{1,2})?$/)]]}))})}addStationRelationRecords(){this.stationRecords.forEach(t=>{this.stationRelationRecords.push(this.fb.group({stationRelationId:[t.stationRelationId],ampere:[0,[S.required,S.pattern(/^\d+(\.\d{1,2})?$/)]]}))})}addTransformerRelationRecords(){this.transformerRecords.forEach(t=>{let i=this.accessCellsRecordData.length>0?this.accessCellsRecordData[0].accessCellId:null,n=this.accessCellsRecordData.length>0?this.accessCellsRecordData[0].accessCellNumber:null;this.transformerRelationRecords.push(this.fb.group({stationRelationId:[t.stationRelationId],ampere:[0,[S.required,S.pattern(/^\d+(\.\d{1,2})?$/)]],accessCellId:[i,[S.required,S.pattern(/^\d+$/)]],firstAccessCellNumber:[n]}))})}onSelectionChange(t,i){let n=this.transformerRelationRecords.at(i);t.value!==n.get("firstAccessCellNumber")?.value&&n.patchValue({firstAccessCellNumber:null})}trackByIndex(t,i){return t}clearValue(t,i,n){let a=i?.at(t)?.get(n);if(a){let p=a;p.firstClick||(a.setValue(""),a.markAsTouched(),p.firstClick=!0)}}onCheckboxChange(t,i){i.target.checked?(this.disabledIndexes.delete(t),this.activeAccessCellNumber.push(t)):(this.disabledIndexes.add(t),this.activeAccessCellNumber=this.activeAccessCellNumber.filter(a=>a!==t),this.stationAccessCell.at(t).get("accessCellValue")?.setValue(0),this.stationAccessCell.at(t).get("voltage22kV")?.setValue(0)),this.updateAccessCellNumber()}isDisabled(t){return this.disabledIndexes.has(t)}updateAccessCellNumber(){this.activeAccessCellNumber.length===1?this.singleActiveIndex=this.activeAccessCellNumber[0]+1:this.singleActiveIndex=0,this.transformerRelationRecords.controls.forEach((t,i)=>{t.get("accessCellNumber")?.setValue(this.singleActiveIndex)})}onSubmit(){if(this.form.valid){let t=this.stationAccessCell.value.map(a=>({accessCellId:a.accessCellId,accessCellValue:a.accessCellValue,voltage22kV:a.voltage22kV})),i=this.transformerRelationRecords.value.map(a=>({stationRelationId:a.stationRelationId,ampere:a.ampere,reactivePower:a.reactivePower,accessCellId:a.accessCellId})),n={stationId:this.stationId,createTransformerRecords:i,createStationAccessCells:t,createStationRecord:{voltage60kV:this.form.get("voltage60kV")?.value,reactivePower:this.form.get("reactivePower")?.value},createStationRelationRecords:this.stationRelationRecords.value};console.log(n),this.stationMonitorService.addStationMonitor(n).subscribe({next:a=>{console.log(a)},error:a=>{console.error("\u062E\u0637\u0623 \u0623\u062B\u0646\u0627\u0621 \u0627\u0644\u0625\u0631\u0633\u0627\u0644:",a),this.snackBarService.showError(` ${a}`)},complete:()=>{this.snackBarService.showSuccess("\u062A\u0645 \u0625\u0631\u0633\u0627\u0644 \u0627\u0644\u0628\u064A\u0627\u0646\u0627\u062A \u0628\u0646\u062C\u0627\u062D"),this.loadFormPostData()}})}else this.snackBarService.showError("\u0647\u0646\u0627\u0643 \u062E\u0637\u0623 \u0641\u064A \u0623\u062D\u062F \u0642\u064A\u0645 \u0627\u0644\u062D\u0642\u0648\u0644 ")}setDefaultValue(){this.transformerRelationRecords.controls.forEach((t,i)=>{t.get("ampere")?.setValue(0),t.get("reactivePower")?.setValue(0)}),this.stationRelationRecords.controls.forEach((t,i)=>{t.get("ampere")?.setValue(0)}),this.stationAccessCell.controls.forEach((t,i)=>{t.get("voltage22kV")?.setValue(0),t.get("accessCellValue")?.setValue(0)}),this.form.get("voltage60kV")?.setValue(null),this.form.get("reactivePower")?.setValue(null)}isFieldInvalid(t,i,n){let a=t.at(i).get(n);return a?a.invalid&&a.touched:!1}hasFieldError(t,i,n,a){let p=t.at(i).get(n);return p?p.hasError(a):!1}};r.\u0275fac=function(i){return new(i||r)(b(H),b(z),b(mt),b(St))},r.\u0275cmp=N({type:r,selectors:[["selected-station-add"]],standalone:!0,features:[U],decls:31,vars:14,consts:[["requiredAndTwoDecimalNumbersError",""],["validationErrors",""],[1,"container"],[3,"ngSubmit","formGroup"],[4,"ngIf"],[1,"title-section"],[1,"row"],[1,"col-md-6"],[1,"form-group"],["for","voltage60kV"],["id","voltage60kV","formControlName","voltage60kV","type","number","step","0.01","required","",1,"form-control",3,"focus","ngClass"],["for","reactivePower"],["id","reactivePower","formControlName","reactivePower","type","number","step","0.01","required","",1,"form-control",3,"focus","ngClass"],["type","submit",1,"btn","btn-primary"],[3,"isLoading"],["formArrayName","stationRelationRecords"],["class","form-group",3,"formGroupName",4,"ngFor","ngForOf","ngForTrackBy"],[1,"form-group",3,"formGroupName"],["formControlName","stationRelationId","type","hidden"],[3,"for"],["formControlName","ampere","type","number","step","0.01",1,"form-control",3,"click","id","ngClass"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],["class","text-danger",4,"ngIf"],[1,"text-danger"],["formArrayName","stationAccessCell"],[1,"form-group","row","align-items-center"],[1,"col-md-12"],["type","checkbox",3,"change","checked"],["formControlName","accessCellId","type","hidden"],[1,"row","mb-3"],[1,"form-label",3,"for"],["formControlName","accessCellValue","type","number","step","0.01",1,"form-control",3,"click","id","disabled","ngClass"],["formControlName","voltage22kV","type","number","step","0.01",1,"form-control",3,"click","id","disabled","ngClass"],["formArrayName","transformerRelationRecords"],[1,"form-group","row"],[1,"col-md-3"],["appearance","outline",2,"margin-top","23px","background-color","rgb(255, 255, 255)"],["formControlName","accessCellId",3,"click","selectionChange","id","ngClass"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],["class","validate",4,"ngIf"],[1,"validate"],["class","text-danger d-block",4,"ngIf"],[1,"text-danger","d-block"]],template:function(i,n){if(i&1){let a=R();c(0,"div",2)(1,"h1"),m(2),s(),c(3,"h2"),m(4,"\u0625\u062F\u062E\u0627\u0644 \u0633\u062C\u0644\u0627\u062A \u0627\u0644\u0639\u0644\u0627\u0642\u0627\u062A \u0628\u064A\u0646 \u0627\u0644\u0645\u062D\u0637\u0627\u062A"),s(),c(5,"form",3),v("ngSubmit",function(){return C(a),h(n.onSubmit())}),f(6,un,5,2,"ng-container",4),c(7,"h3",5),m(8,"\u0627\u0644\u062C\u0647\u062F \u0648\u0627\u0644\u0637\u0627\u0642\u0629 \u0627\u0644\u0636\u0627\u0626\u0639\u0629"),s(),c(9,"div",6)(10,"div",7)(11,"div",8)(12,"label",9),m(13,"\u0627\u0644\u062C\u0647\u062F \u0627\u0644\u0639\u0627\u0644\u064A"),s(),c(14,"input",10),v("focus",function(){let _;return C(a),h((_=n.form.get("voltage60kV"))==null?null:_.markAsTouched())}),s(),f(15,gn,4,3,"div",4),s()(),c(16,"div",7)(17,"div",8)(18,"label",11),m(19,"\u0627\u0644\u0642\u062F\u0631\u0629 \u0627\u0644\u062A\u0641\u0627\u0639\u0644\u064A\u0629"),s(),c(20,"input",12),v("focus",function(){let _;return C(a),h((_=n.form.get("reactivePower"))==null?null:_.markAsTouched())}),s(),f(21,vn,3,2,"div",4),s()()(),f(22,yn,5,2,"ng-container",4)(23,wn,5,2,"ng-container",4),c(24,"button",13),m(25,"\u062D\u0641\u0638"),s()()(),f(26,On,1,1,"ng-template",null,0,W)(28,qn,1,1,"ng-template",null,1,W),I(30,"app-loading-spinner",14)}if(i&2){let a,p,_,g;l(2),x(n.entryDate),l(3),d("formGroup",n.form),l(),d("ngIf",n.stationRecords.length>0),l(8),d("ngClass",y(10,Q,((a=n.form.get("voltage60kV"))==null?null:a.invalid)&&(((a=n.form.get("voltage60kV"))==null?null:a.dirty)||((a=n.form.get("voltage60kV"))==null?null:a.touched)))),l(),d("ngIf",((p=n.form.get("voltage60kV"))==null?null:p.invalid)&&(((p=n.form.get("voltage60kV"))==null?null:p.dirty)||((p=n.form.get("voltage60kV"))==null?null:p.touched))),l(5),d("ngClass",y(12,Q,((_=n.form.get("reactivePower"))==null?null:_.invalid)&&(((_=n.form.get("reactivePower"))==null?null:_.dirty)||((_=n.form.get("reactivePower"))==null?null:_.touched)))),l(),d("ngIf",((g=n.form.get("reactivePower"))==null?null:g.invalid)&&(((g=n.form.get("reactivePower"))==null?null:g.dirty)||((g=n.form.get("reactivePower"))==null?null:g.touched))),l(),d("ngIf",n.accessCellsRecordData.length>0),l(),d("ngIf",n.transformerRecords.length>0),l(7),d("isLoading",n.isLoading)}},dependencies:[bt,_t,et,ft,nt,ut,xt,gt,vt,Ct,ht,G,X,q,Y,dt,L,j,$,B,it],styles:['@charset "UTF-8";.container[_ngcontent-%COMP%]{padding:20px}.container[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin-bottom:20px;font-size:1.5rem;color:#333}.container[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{border-bottom:2px solid #ddd;font-size:1.25rem;color:#555;margin-top:20px;margin-bottom:20px;border:1px solid;width:max-content;padding:20px;border-radius:15px;background-color:#dee1de}.form-group[_ngcontent-%COMP%]{margin-bottom:20px}.form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block;margin-bottom:5px;font-weight:700}.form-control[_ngcontent-%COMP%]{width:100%;padding:10px;margin-top:5px;border:1px solid #ccc;border-radius:4px}.btn[_ngcontent-%COMP%]{margin-top:20px}.highVlot[_ngcontent-%COMP%]{margin-bottom:20px;padding-bottom:10px;border-bottom:2px solid #b3b1e4}.highVlot[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{background-color:#f9f9f9;border:1px solid #007bff;padding:10px;border-radius:4px;transition:all .3s ease-in-out;margin-bottom:30px}.highVlot[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus{background-color:#fff;border-color:#0056b3}.validate[_ngcontent-%COMP%]{padding:10px;font-size:14;font-weight:700}.warning-class[_ngcontent-%COMP%]{border:1px solid red;background-color:#fcc}.error-message[_ngcontent-%COMP%]{position:absolute;top:100%;left:0;color:#c43f3f;font-size:.8rem;margin-top:.5rem;display:block}.error-message.hidden[_ngcontent-%COMP%]{display:none}  .mat-mdc-form-field-subscript-wrapper{display:none!important}.is-invalid[_ngcontent-%COMP%]{border-color:#dc3545}']});let e=r;return e})();var J=e=>({"is-invalid":e}),qe=(e,r)=>({formArray:e,index:r,field:"ampere"}),Bn=(e,r)=>({formArray:e,index:r,field:"accessCellValue"}),jn=(e,r)=>({formArray:e,index:r,field:"voltage22kV"}),Ln=(e,r)=>({formArray:e,index:r,field:"accessCellId"}),$n=(e,r)=>({formArray:e,index:r,field:"reactivePower"});function Gn(e,r){if(e&1){let o=R();c(0,"div")(1,"h1"),m(2),s(),c(3,"button",18),v("click",function(){C(o);let i=u();return h(i.enableEdit())}),m(4,"\u062A\u0639\u062F\u064A\u0644"),s()()}if(e&2){let o=u();l(2),x(o.entryDate)}}function zn(e,r){if(e&1){let o=R();c(0,"div",19)(1,"label",20),m(2,"\u062A\u0627\u0631\u064A\u062E \u0627\u0644\u062F\u062E\u0648\u0644:"),s(),c(3,"input",21),lt("ngModelChange",function(i){C(o);let n=u();return rt(n.entryDate,i)||(n.entryDate=i),h(i)}),s(),c(4,"div",22)(5,"button",18),v("click",function(){C(o);let i=u();return h(i.confirmEdit())}),m(6,"\u062A\u0623\u0643\u064A\u062F"),s(),c(7,"button",23),v("click",function(){C(o);let i=u();return h(i.cancelEdit())}),m(8,"\u0625\u0644\u063A\u0627\u0621"),s(),c(9,"button",24),v("click",function(){C(o);let i=u();return h(i.resetValue())}),m(10,"\u0625\u0639\u0627\u062F\u0629 \u062A\u0639\u064A\u064A\u0646"),s()()()}if(e&2){let o=u();l(3),at("ngModel",o.entryDate)}}function Hn(e,r){e&1&&E(0)}function Wn(e,r){if(e&1){let o=R();c(0,"div",27)(1,"label"),m(2),s(),I(3,"input",28),c(4,"div",11)(5,"label",29),m(6,"\u0627\u0644\u0623\u0645\u0628\u064A\u0631"),s(),c(7,"input",30),v("click",function(){let i=C(o).index,n=u(2);return h(n.clearValue(i,n.stationRelationRecords,"ampere"))}),s(),f(8,Hn,1,0,"ng-container",31),s()()}if(e&2){let o=r.index,t=u(2),i=w(28);d("formGroupName",o),l(2),x(t.stationRecords[o].title||"\u0627\u0644\u0639\u0646\u0648\u0627\u0646 \u063A\u064A\u0631 \u0645\u062A\u0648\u0641\u0631"),l(3),M("for","ampere-station-",o,""),l(2),M("id","ampere-station-",o,""),d("ngClass",y(9,J,t.isFieldInvalid(t.stationRelationRecords,o,"ampere"))),l(),d("ngTemplateOutlet",i)("ngTemplateOutletContext",k(11,qe,t.stationRelationRecords,o))}}function Qn(e,r){if(e&1&&(V(0),c(1,"div",25)(2,"h3",8),m(3,"\u0633\u062C\u0644\u0627\u062A \u0627\u0644\u0645\u062D\u0637\u0627\u062A"),s(),f(4,Wn,9,14,"div",26),s(),D()),e&2){let o=u();l(4),d("ngForOf",o.stationRelationRecords.controls)("ngForTrackBy",o.trackByIndex)}}function Jn(e,r){if(e&1&&(c(0,"small",33),m(1),s()),e&2){let o=u(2);l(),x(o.validationMessage.min)}}function Kn(e,r){if(e&1&&(c(0,"small",33),m(1),s()),e&2){let o=u(2);l(),T(" ",o.validationMessage.required,"")}}function Xn(e,r){if(e&1&&(c(0,"small",33),m(1),s()),e&2){let o=u(2);l(),x(o.validationMessage.pattern)}}function Yn(e,r){if(e&1&&(c(0,"div"),f(1,Jn,2,1,"small",32)(2,Kn,2,1,"small",32)(3,Xn,2,1,"small",32),s()),e&2){let o,t,i,n=u();l(),d("ngIf",(o=n.form.get("voltage60kV"))==null?null:o.hasError("min")),l(),d("ngIf",(t=n.form.get("voltage60kV"))==null?null:t.hasError("required")),l(),d("ngIf",(i=n.form.get("voltage60kV"))==null?null:i.hasError("pattern"))}}function Zn(e,r){if(e&1&&(c(0,"small",33),m(1),s()),e&2){let o=u(2);l(),x(o.validationMessage.required)}}function ti(e,r){if(e&1&&(c(0,"small",33),m(1),s()),e&2){let o=u(2);l(),x(o.validationMessage.pattern)}}function ei(e,r){if(e&1&&(c(0,"div"),f(1,Zn,2,1,"small",32)(2,ti,2,1,"small",32),s()),e&2){let o,t,i=u();l(),d("ngIf",(o=i.form.get("reactivePower"))==null?null:o.hasError("required")),l(),d("ngIf",(t=i.form.get("reactivePower"))==null?null:t.hasError("pattern"))}}function ni(e,r){e&1&&E(0)}function ii(e,r){if(e&1&&(c(0,"small",33),m(1),s()),e&2){let o=u(3);l(),x(o.validationMessage.min)}}function oi(e,r){e&1&&E(0)}function ai(e,r){if(e&1){let o=R();c(0,"div",27)(1,"div",35)(2,"div",36)(3,"label")(4,"input",37),v("change",function(i){let n=C(o).index,a=u(2);return h(a.onCheckboxChange(n,i))}),s(),m(5),s()(),I(6,"input",38),c(7,"div",39)(8,"div",10)(9,"label",40),m(10,"\u0627\u0644\u0642\u064A\u0645\u0629"),s(),c(11,"input",41),v("click",function(){let i=C(o).index,n=u(2);return h(n.clearValue(i,n.stationAccessCell,"accessCellValue"))}),s(),f(12,ni,1,0,"ng-container",31),s(),c(13,"div",10)(14,"label",40),m(15,"\u0627\u0644\u062C\u0647\u062F"),s(),c(16,"input",42),v("click",function(){let i=C(o).index,n=u(2);return h(n.clearValue(i,n.stationAccessCell,"voltage22kV"))}),s(),f(17,ii,2,1,"small",32)(18,oi,1,0,"ng-container",31),s()()()()}if(e&2){let o,t,i,n,a,p=r.$implicit,_=r.index,g=u(2),A=w(28);d("formGroupName",_),l(4),d("checked",!0),l(),T(" \u062E\u0644\u064A\u0629 \u0627\u0644\u0648\u0635\u0648\u0644 \u0631\u0642\u0645 ",p.value.accessCellNumber," "),l(4),M("for","accessCellValue-",(o=p.get("accessCellNumber"))==null?null:o.value,""),l(2),M("id","accessCellValue-",(t=p.get("accessCellNumber"))==null?null:t.value,""),d("disabled",g.isDisabled(_))("ngClass",y(20,J,g.isFieldInvalid(g.stationAccessCell,_,"accessCellValue"))),l(),d("ngTemplateOutlet",A)("ngTemplateOutletContext",k(22,Bn,g.stationAccessCell,_)),l(2),M("for","voltage22kV-",(i=p.get("accessCellNumber"))==null?null:i.value,""),l(2),M("id","voltage22kV-",(n=p.get("accessCellNumber"))==null?null:n.value,""),d("disabled",g.isDisabled(_))("ngClass",y(25,J,g.isFieldInvalid(g.stationAccessCell,_,"voltage22kV"))),l(),d("ngIf",(a=g.stationAccessCell.at(_).get("voltage22kV"))==null?null:a.hasError("min")),l(),d("ngTemplateOutlet",A)("ngTemplateOutletContext",k(27,jn,g.stationAccessCell,_))}}function ri(e,r){if(e&1&&(V(0),c(1,"div",34)(2,"h3"),m(3,"\u0633\u062C\u0644\u0627\u062A \u0627\u0644\u0648\u0635\u0648\u0644 \u0625\u0644\u0649 \u0627\u0644\u062E\u0644\u0627\u064A\u0627"),s(),f(4,ai,19,30,"div",26),s(),D()),e&2){let o=u();l(4),d("ngForOf",o.stationAccessCell.controls)("ngForTrackBy",o.trackByIndex)}}function li(e,r){if(e&1&&(c(0,"mat-option",49),m(1),s()),e&2){let o=r.$implicit;d("value",o.accessCellId),l(),T(" ",o.accessCellNumber," ")}}function si(e,r){e&1&&E(0)}function ci(e,r){e&1&&E(0)}function di(e,r){e&1&&E(0)}function mi(e,r){if(e&1){let o=R();c(0,"div",27)(1,"label"),m(2),s(),I(3,"input",28),c(4,"div",44)(5,"div",45)(6,"mat-form-field",46)(7,"mat-label"),m(8,"\u0627\u062E\u062A\u0631 \u0627\u0644\u062E\u0644\u064A\u0629"),s(),c(9,"mat-select",47),v("click",function(){let i=C(o).index,n=u(2);return h(n.clearValue(i,n.transformerRelationRecords,"accessCellId"))})("selectionChange",function(i){let n=C(o).index,a=u(2);return h(a.onSelectionChange(i,n))}),f(10,li,2,2,"mat-option",48),s()(),f(11,si,1,0,"ng-container",31),s(),c(12,"div",10)(13,"label",29),m(14,"\u0627\u0644\u0623\u0645\u0628\u064A\u0631"),s(),c(15,"input",30),v("click",function(){let i=C(o).index,n=u(2);return h(n.clearValue(i,n.transformerRelationRecords,"ampere"))}),s(),f(16,ci,1,0,"ng-container",31),s(),c(17,"div",45),f(18,di,1,0,"ng-container",31),s()()()}if(e&2){let o=r.index,t=u(2),i=w(28),n=w(30);d("formGroupName",o),l(2),x(t.transformerRecords[o].title||"\u0627\u0644\u0639\u0646\u0648\u0627\u0646 \u063A\u064A\u0631 \u0645\u062A\u0648\u0641\u0631"),l(7),M("id","accessCellNumber-",o,""),d("ngClass",y(17,J,t.isFieldInvalid(t.transformerRelationRecords,o,"accessCellId"))),l(),d("ngForOf",t.accessCellsRecordData),l(),d("ngTemplateOutlet",n)("ngTemplateOutletContext",k(19,Ln,t.transformerRelationRecords,o)),l(2),M("for","ampere-transformer-",o,""),l(2),M("id","ampere-transformer-",o,""),d("ngClass",y(22,J,t.isFieldInvalid(t.transformerRelationRecords,o,"ampere"))),l(),d("ngTemplateOutlet",i)("ngTemplateOutletContext",k(24,qe,t.transformerRelationRecords,o)),l(2),d("ngTemplateOutlet",i)("ngTemplateOutletContext",k(27,$n,t.transformerRelationRecords,o))}}function ui(e,r){if(e&1&&(V(0),c(1,"div",43)(2,"h3"),m(3,"\u0633\u062C\u0644\u0627\u062A \u0627\u0644\u0645\u062D\u0648\u0644\u0627\u062A"),s(),f(4,mi,19,30,"div",26),s(),D()),e&2){let o=u();l(4),d("ngForOf",o.transformerRelationRecords.controls)("ngForTrackBy",o.trackByIndex)}}function pi(e,r){if(e&1&&(c(0,"small",33),m(1),s()),e&2){let o=u(3);l(),x(o.validationMessage.required)}}function _i(e,r){if(e&1&&(c(0,"small",33),m(1),s()),e&2){let o=u(3);l(),x(o.validationMessage.pattern)}}function fi(e,r){if(e&1&&(c(0,"div",51),f(1,pi,2,1,"small",32)(2,_i,2,1,"small",32),s()),e&2){let o=u(),t=o.formArray,i=o.index,n=o.field,a=u();l(),d("ngIf",a.hasFieldError(t,i,n,"required")),l(),d("ngIf",a.hasFieldError(t,i,n,"pattern"))}}function gi(e,r){if(e&1&&f(0,fi,3,2,"div",50),e&2){let o=r.formArray,t=r.index,i=r.field,n=u();d("ngIf",n.isFieldInvalid(o,t,i))}}function Ci(e,r){if(e&1&&(c(0,"small",33),m(1),s()),e&2){let o=u(3);l(),x(o.validationMessage.required)}}function hi(e,r){if(e&1&&(c(0,"small",33),m(1),s()),e&2){let o=u(3);l(),x(o.validationMessage.pattern)}}function vi(e,r){if(e&1&&(c(0,"small",53),m(1),s()),e&2){let o=u(3);l(),x(o.validationMessage.rangeError)}}function xi(e,r){if(e&1&&(c(0,"div",51),f(1,Ci,2,1,"small",32)(2,hi,2,1,"small",32)(3,vi,2,1,"small",52),s()),e&2){let o=u(),t=o.formArray,i=o.index,n=o.field,a=u();l(),d("ngIf",a.hasFieldError(t,i,n,"required")),l(),d("ngIf",a.hasFieldError(t,i,n,"pattern")),l(),d("ngIf",a.hasFieldError(t,i,n,"rangeError"))}}function Si(e,r){if(e&1&&f(0,xi,4,3,"div",50),e&2){let o=r.formArray,t=r.index,i=r.field,n=u();d("ngIf",n.isFieldInvalid(o,t,i))}}var Be=(()=>{let r=class r{enableEdit(){this.isEditing=!0}confirmEdit(){this.isEditing=!1}cancelEdit(){this.isEditing=!1}resetValue(){this.entryDate=this.stationFormData.entryDate}constructor(t,i,n,a,p){this.stationMonitorService=t,this.snackBarService=i,this.route=n,this.router=a,this.fb=p,this.validationMessage={required:"\u064A\u062C\u0628 \u0625\u062F\u062E\u0627\u0644 \u0642\u064A\u0645\u0629.",min:"\u0627\u0644\u062C\u0647\u062F \u0644\u0627 \u064A\u0645\u0643\u0646 \u0623\u0646 \u064A\u0643\u0648\u0646 \u0633\u0627\u0644\u0628 \u0623\u0648 \u0635\u0641\u0631.",pattern:"\u064A\u062C\u0628 \u0623\u0646 \u062A\u0643\u0648\u0646 \u0627\u0644\u0642\u064A\u0645\u0629 \u0639\u062F\u062F\u064B\u0627 \u0635\u062D\u064A\u062D\u064B\u0627 \u0623\u0648 \u0639\u062F\u062F\u064B\u0627 \u0639\u0634\u0631\u064A\u064B\u0627.",rangeError:"\u064A\u062C\u0628 \u0623\u0646 \u064A\u0643\u0648\u0646 \u0631\u0642\u0645 \u0627\u0644\u062E\u0644\u064A\u0629 \u0645\u0637\u0627\u0628\u0642\u064B\u0627 \u0644\u0631\u0642\u0645 \u0623\u062D\u062F \u0627\u0644\u062E\u0644\u0627\u064A\u0627."},this.disabledIndexes=new Set,this.singleActiveIndex=0,this.activeAccessCellNumber=[],this.isLoading=!1,this.stationRecords=[],this.transformerRecords=[],this.accessCellsRecordData=[],this.isEditing=!1,this.form=this.fb.group({stationRelationRecords:this.fb.array([]),transformerRelationRecords:this.fb.array([]),stationAccessCell:this.fb.array([]),voltage60kV:[null],reactivePower:[null,[S.required]]})}ngOnInit(){this.isLoading=!0,this.stationId=Number(this.route.snapshot.queryParamMap.get("stationId")),this.monitorId=Number(this.route.snapshot.queryParamMap.get("monitorId")),this.stationMonitorService.getStationMonitorById(this.monitorId).subscribe(t=>{this.stationMonitorDto=t,this.entryDate=this.stationMonitorDto.entryDate,console.log(this.stationMonitorDto),this.form.patchValue({voltage60kV:this.stationMonitorDto.stationRecordDto.voltage66kV,reactivePower:this.stationMonitorDto.stationRecordDto.reactivePower})}),this.loadFormPostData()}loadFormPostData(){this.stationMonitorService.getFormData(this.stationId,!0).subscribe({next:t=>{this.stationFormData=t,this.stationFormData.stationRecordData.length>0&&(this.stationRecords=this.stationFormData.stationRecordData,this.addStationRelationRecords()),this.stationFormData.accessCellsRecordData.length>0&&(this.accessCellsRecordData=this.stationFormData.accessCellsRecordData,this.addStationAccessCells()),this.stationFormData.transformerRecordData.length>0&&(this.transformerRecords=this.stationFormData.transformerRecordData,this.addTransformerRelationRecords()),this.isLoading=!1},error:t=>{let i=`\u062D\u062F\u062B \u062E\u0637\u0623 \u0645\u0627 
 ${t.error}`;this.isLoading=!1,this.snackBarService.showError(i)}})}get stationRelationRecords(){return this.form.get("stationRelationRecords")}get transformerRelationRecords(){return this.form.get("transformerRelationRecords")}get stationAccessCell(){return this.form.get("stationAccessCell")}addStationAccessCells(){this.accessCellsRecordData.forEach(t=>{this.stationAccessCell.push(this.fb.group({accessCellId:[t.accessCellId],accessCellNumber:[t.accessCellNumber],voltage22kV:[this.getStationAccessCellData(t.accessCellId,"voltage22kV"),[S.required,S.pattern(/^\d+(\.\d{1,2})?$/),S.min(0)]],accessCellValue:[this.getStationAccessCellData(t.accessCellId,"accessCellValue"),[S.required,S.pattern(/^\d+(\.\d+)?$/)]]}))})}getStationAccessCellData(t,i){let n=this.stationMonitorDto.stationAccessCellDtos.find(a=>a.accessCellId===t);return n?n[i]:0}addStationRelationRecords(){this.stationRecords.forEach(t=>{this.stationRelationRecords.push(this.fb.group({stationRelationId:[t.stationRelationId],ampere:[this.getStationRelationRecordsAmpere(t.stationRelationId),[S.required,S.pattern(/^\d+(\.\d+)?$/)]]}))})}getStationRelationRecordsAmpere(t){let i=this.stationMonitorDto.stationRelationRecordDtos.find(n=>n.stationRelationId===t);return i?i.ampere:0}addTransformerRelationRecords(){this.transformerRecords.forEach(t=>{let i=this.getTransformerField(t.stationRelationId,"accessCellId");this.transformerRelationRecords.push(this.fb.group({stationRelationId:[t.stationRelationId],ampere:[this.getTransformerField(t.stationRelationId,"ampere"),[S.required,S.pattern(/^\d+(\.\d+)?$/)]],accessCellId:[i,[S.required,S.pattern(/^\d+$/)]],firstAccessCellNumber:[this.getAccessCellNumber(i)]}))})}getTransformerField(t,i){let n=this.stationMonitorDto.transformerMonitoringDtos.find(a=>a.stationRelationId===t);return n?n[i]:0}getAccessCellNumber(t){let i=this.stationMonitorDto.stationAccessCellDtos.find(n=>n.accessCellId===t);return i?i.accessCellNumber:0}onSelectionChange(t,i){let n=this.transformerRelationRecords.at(i);t.value!==n.get("firstAccessCellNumber")?.value&&n.patchValue({firstAccessCellNumber:null})}trackByIndex(t,i){return t}clearValue(t,i,n){let a=i?.at(t)?.get(n);if(a){let p=a;p.firstClick||(a.setValue(""),a.markAsTouched(),p.firstClick=!0)}}onCheckboxChange(t,i){i.target.checked?(this.disabledIndexes.delete(t),this.activeAccessCellNumber.push(t)):(this.disabledIndexes.add(t),this.activeAccessCellNumber=this.activeAccessCellNumber.filter(a=>a!==t),this.stationAccessCell.at(t).get("accessCellValue")?.setValue(0),this.stationAccessCell.at(t).get("voltage22kV")?.setValue(0)),this.updateAccessCellNumber()}isDisabled(t){return this.disabledIndexes.has(t)}updateAccessCellNumber(){this.activeAccessCellNumber.length===1?this.singleActiveIndex=this.activeAccessCellNumber[0]+1:this.singleActiveIndex=0,this.transformerRelationRecords.controls.forEach((t,i)=>{t.get("accessCellNumber")?.setValue(this.singleActiveIndex)})}onSubmit(){if(this.form.valid){let t=this.stationAccessCell.value.map(a=>({accessCellId:a.accessCellId,accessCellValue:a.accessCellValue,voltage22kV:a.voltage22kV})),i=this.transformerRelationRecords.value.map(a=>({stationRelationId:a.stationRelationId,ampere:a.ampere,accessCellId:a.accessCellId})),n={entryDate:this.entryDate,stationId:this.stationId,monitorId:this.monitorId,updateTransformerRecords:i,updateStationAccessCells:t,updateStationRecord:{voltage60kV:this.form.get("voltage60kV")?.value,reactivePower:this.form.get("reactivePower")?.value},updateStationRelationRecords:this.stationRelationRecords.value};console.log(n),this.stationMonitorService.putStationMonitor(n).subscribe({next:()=>{console.log("\u062A\u0645 \u062A\u062D\u062F\u064A\u062B \u0628\u064A\u0627\u0646\u0627\u062A \u0645\u062D\u0637\u0629 \u0627\u0644\u0645\u0631\u0627\u0642\u0628\u0629 \u0628\u0646\u062C\u0627\u062D.")},error:a=>{console.error("\u062D\u062F\u062B \u062E\u0637\u0623 \u0623\u062B\u0646\u0627\u0621 \u062A\u062D\u062F\u064A\u062B \u0627\u0644\u0628\u064A\u0627\u0646\u0627\u062A:",a)},complete:()=>{this.router.navigate(["/station-monitor"])}})}else{let t=`\u0647\u0646\u0627\u0643 \u062E\u0637\u0623 \u0641\u064A \u0627\u0644\u062D\u0642\u0648\u0644 \u0627\u0644\u062A\u0627\u0644\u064A\u0629:
`;Object.keys(this.form.controls).forEach(i=>{this.form.get(i)?.invalid&&(t+=`- ${i}
`)}),this.snackBarService.showError(t)}}setDefaultValue(){this.transformerRelationRecords.controls.forEach((t,i)=>{t.get("ampere")?.setValue(0),t.get("reactivePower")?.setValue(0)}),this.stationRelationRecords.controls.forEach((t,i)=>{t.get("ampere")?.setValue(0)}),this.stationAccessCell.controls.forEach((t,i)=>{t.get("voltage22kV")?.setValue(0),t.get("accessCellValue")?.setValue(0)}),this.form.get("voltage60kV")?.setValue(null),this.form.get("reactivePower")?.setValue(null)}isFieldInvalid(t,i,n){let a=t.at(i).get(n);return a?a.invalid&&a.touched:!1}hasFieldError(t,i,n,a){let p=t.at(i).get(n);return p?p.hasError(a):!1}};r.\u0275fac=function(i){return new(i||r)(b(H),b(z),b(mt),b(Z),b(St))},r.\u0275cmp=N({type:r,selectors:[["app-update-station-monitor"]],standalone:!0,features:[U],decls:32,vars:15,consts:[["editMode",""],["requiredAndTwoDecimalNumbersError",""],["validationErrors",""],[1,"container"],[4,"ngIf","ngIfElse"],[1,"my-2"],[3,"ngSubmit","formGroup"],[4,"ngIf"],[1,"title-section"],[1,"row"],[1,"col-md-6"],[1,"form-group"],["for","voltage60kV"],["id","voltage60kV","formControlName","voltage60kV","type","number","step","0.01","required","",1,"form-control",3,"focus","ngClass"],["for","reactivePower"],["id","reactivePower","formControlName","reactivePower","type","number","step","0.01","required","",1,"form-control",3,"focus","ngClass"],["type","submit",1,"btn","btn-primary"],[3,"isLoading"],["mat-raised-button","","color","primary",3,"click"],[1,"edit-container"],["for","entryDate"],["id","entryDate","type","datetime-local",1,"date-input",3,"ngModelChange","ngModel"],[1,"button-group"],["mat-raised-button","","color","warn",2,"color","white",3,"click"],["mat-raised-button","","color","success",3,"click"],["formArrayName","stationRelationRecords"],["class","form-group",3,"formGroupName",4,"ngFor","ngForOf","ngForTrackBy"],[1,"form-group",3,"formGroupName"],["formControlName","stationRelationId","type","hidden"],[3,"for"],["formControlName","ampere","type","number","step","0.01",1,"form-control",3,"click","id","ngClass"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],["class","text-danger",4,"ngIf"],[1,"text-danger"],["formArrayName","stationAccessCell"],[1,"form-group","row","align-items-center"],[1,"col-md-12"],["type","checkbox",3,"change","checked"],["formControlName","accessCellId","type","hidden"],[1,"row","mb-3"],[1,"form-label",3,"for"],["formControlName","accessCellValue","type","number","step","0.01",1,"form-control",3,"click","id","disabled","ngClass"],["formControlName","voltage22kV","type","number","step","0.01",1,"form-control",3,"click","id","disabled","ngClass"],["formArrayName","transformerRelationRecords"],[1,"form-group","row"],[1,"col-md-3"],["appearance","outline",2,"margin-top","23px","background-color","rgb(255, 255, 255)"],["formControlName","accessCellId",3,"click","selectionChange","id","ngClass"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],["class","validate",4,"ngIf"],[1,"validate"],["class","text-danger d-block",4,"ngIf"],[1,"text-danger","d-block"]],template:function(i,n){if(i&1){let a=R();c(0,"div",3),f(1,Gn,5,1,"div",4)(2,zn,11,1,"ng-template",null,0,W),c(4,"h2",5),m(5,"\u062A\u0639\u062F\u064A\u0644 \u0633\u062C\u0644\u0627\u062A \u0627\u0644\u0639\u0644\u0627\u0642\u0627\u062A \u0628\u064A\u0646 \u0627\u0644\u0645\u062D\u0637\u0627\u062A"),s(),c(6,"form",6),v("ngSubmit",function(){return C(a),h(n.onSubmit())}),f(7,Qn,5,2,"ng-container",7),c(8,"h3",8),m(9,"\u0627\u0644\u062C\u0647\u062F \u0648\u0627\u0644\u0637\u0627\u0642\u0629 \u0627\u0644\u0636\u0627\u0626\u0639\u0629"),s(),c(10,"div",9)(11,"div",10)(12,"div",11)(13,"label",12),m(14,"\u0627\u0644\u062C\u0647\u062F \u0627\u0644\u0639\u0627\u0644\u064A"),s(),c(15,"input",13),v("focus",function(){let _;return C(a),h((_=n.form.get("voltage60kV"))==null?null:_.markAsTouched())}),s(),f(16,Yn,4,3,"div",7),s()(),c(17,"div",10)(18,"div",11)(19,"label",14),m(20,"\u0627\u0644\u0642\u062F\u0631\u0629 \u0627\u0644\u062A\u0641\u0627\u0639\u0644\u064A\u0629"),s(),c(21,"input",15),v("focus",function(){let _;return C(a),h((_=n.form.get("reactivePower"))==null?null:_.markAsTouched())}),s(),f(22,ei,3,2,"div",7),s()()(),f(23,ri,5,2,"ng-container",7)(24,ui,5,2,"ng-container",7),c(25,"button",16),m(26,"\u062D\u0641\u0638"),s()()(),f(27,gi,1,1,"ng-template",null,1,W)(29,Si,1,1,"ng-template",null,2,W),I(31,"app-loading-spinner",17)}if(i&2){let a,p,_,g,A=w(3);l(),d("ngIf",!n.isEditing)("ngIfElse",A),l(5),d("formGroup",n.form),l(),d("ngIf",n.stationRecords.length>0),l(8),d("ngClass",y(11,J,((a=n.form.get("voltage60kV"))==null?null:a.invalid)&&(((a=n.form.get("voltage60kV"))==null?null:a.dirty)||((a=n.form.get("voltage60kV"))==null?null:a.touched)))),l(),d("ngIf",((p=n.form.get("voltage60kV"))==null?null:p.invalid)&&(((p=n.form.get("voltage60kV"))==null?null:p.dirty)||((p=n.form.get("voltage60kV"))==null?null:p.touched))),l(5),d("ngClass",y(13,J,((_=n.form.get("reactivePower"))==null?null:_.invalid)&&(((_=n.form.get("reactivePower"))==null?null:_.dirty)||((_=n.form.get("reactivePower"))==null?null:_.touched)))),l(),d("ngIf",((g=n.form.get("reactivePower"))==null?null:g.invalid)&&(((g=n.form.get("reactivePower"))==null?null:g.dirty)||((g=n.form.get("reactivePower"))==null?null:g.touched))),l(),d("ngIf",n.accessCellsRecordData.length>0),l(),d("ngIf",n.transformerRecords.length>0),l(7),d("isLoading",n.isLoading)}},dependencies:[bt,_t,et,ft,nt,ut,xt,gt,vt,Ct,ht,G,X,q,Y,dt,L,j,tt,pt,$,B,it],styles:['@charset "UTF-8";.container[_ngcontent-%COMP%]{padding:20px}.container[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin-bottom:20px;font-size:1.5rem;color:#333}.container[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{border-bottom:2px solid #ddd;font-size:1.25rem;color:#555;margin-top:20px;margin-bottom:20px;border:1px solid;width:max-content;padding:20px;border-radius:15px;background-color:#dee1de}.form-group[_ngcontent-%COMP%]{margin-bottom:20px}.form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block;margin-bottom:5px;font-weight:700}.form-control[_ngcontent-%COMP%]{width:100%;padding:10px;margin-top:5px;border:1px solid #ccc;border-radius:4px}.btn[_ngcontent-%COMP%]{margin-top:20px}.highVlot[_ngcontent-%COMP%]{margin-bottom:20px;padding-bottom:10px;border-bottom:2px solid #b3b1e4}.highVlot[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{background-color:#f9f9f9;border:1px solid #007bff;padding:10px;border-radius:4px;transition:all .3s ease-in-out;margin-bottom:30px}.highVlot[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus{background-color:#fff;border-color:#0056b3}.validate[_ngcontent-%COMP%]{padding:10px;font-size:14;font-weight:700}.warning-class[_ngcontent-%COMP%]{border:1px solid red;background-color:#fcc}.error-message[_ngcontent-%COMP%]{position:absolute;top:100%;left:0;color:#c43f3f;font-size:.8rem;margin-top:.5rem;display:block}.error-message.hidden[_ngcontent-%COMP%]{display:none}  .mat-mdc-form-field-subscript-wrapper{display:none!important}.is-invalid[_ngcontent-%COMP%]{border-color:#dc3545}.edit-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:flex-start;gap:15px}.edit-container[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-weight:700;font-size:1.1rem}.edit-container[_ngcontent-%COMP%]   .date-input[_ngcontent-%COMP%]{width:100%;padding:8px;font-size:1rem;border:1px solid #ccc;border-radius:4px}.edit-container[_ngcontent-%COMP%]   .button-group[_ngcontent-%COMP%]{display:flex;justify-content:flex-start;gap:10px}.edit-container[_ngcontent-%COMP%]   .button-group[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{min-width:100px}']});let e=r;return e})();var Po=[{path:"",component:Fe},{path:"create/:id",component:Ue},{path:"update",component:Be}];export{Po as routes};
